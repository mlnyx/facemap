# 치과용 얼굴 좌표 인식 프로그램

MediaPipe를 활용한 실시간 얼굴 랜드마크 감지 및 분석 프로그램입니다.
**Willis 안면 계측법**을 통한 수직 고경 평가와 **입/턱 상세 분석**을 제공합니다.

## 📚 논문 기반 개발

이 프로그램은 다음 논문을 기반으로 개발되었습니다:

- **"딥러닝 기반 Neuro-T 모델을 이용한 Willis 안면 계측법의 안모 비율 분류 정확도 및 교육적 효과 평가"**
- 전남대학교 치과대학 박사학위 논문 (김수헌, 2025)

### Willis 안면 계측법이란?

Willis 안면 계측법은 수직 고경(Vertical Dimension of Occlusion, VDO) 감소를 진단하는 방법입니다:

1. **동공 중심 - 구열(입) 거리** 측정
2. **비저부(코 아래) - 턱끝 거리** 측정
3. 두 거리를 비교하여 비율 계산

**판정 기준:**

- ✅ **정상**: 비율 0.95 ~ 1.05 (두 거리가 거의 같음)
- ⚠️ **평균 이하**: 비율 < 0.95 (수직 고경 감소 가능성)

수직 고경이 감소하면 심미성 저하, 저작 효율 감소, 측두하악장애 등이 발생할 수 있어 조기 진단이 중요합니다.

## 주요 기능 ✨

### 1️⃣ Willis 안면 계측법 (핵심 기능)

- 🎯 **수직 고경 자동 평가**: 정상 vs 평균 이하 실시간 자동 판정
- 📏 **동공-구열 거리** 측정 (파란선으로 표시)
- 📐 **비저부-턱끝 거리** 측정 (빨간선으로 표시)
- 🔢 **비율 계산 및 실시간 분류**
- ✅ **색상 코드**: 초록(정상) / 빨강(평균 이하 - 수직고경 감소)
- 📊 **리포트 생성**: JSON 형식으로 측정 데이터 저장

### 2️⃣ 상세 입/턱 분석

- 👄 입술 외곽 및 내부 윤곽 감지
- 🦴 턱 라인 및 턱 끝 랜드마크 감지
- 📏 입 너비/높이, 턱 너비/길이 실시간 측정
- 📊 입 벌림 정도, 턱 각도 계산
- ⚖️ 얼굴 대칭성 점수 분석
- 📈 실시간 그래프 표시

## 설치 방법 🚀

### 1. Python 환경 확인

Python 3.8 이상이 필요합니다.

```bash
python --version
```

### 2. 필수 패키지 설치

```bash
pip install -r requirements.txt
```

또는 개별 설치:

```bash
pip install opencv-python mediapipe numpy matplotlib
```

## 사용 방법 📖

### ⭐ 통합 모드 (권장) - Willis + 상세 분석

모든 기능을 사용할 수 있으며, TAB 키로 모드 전환이 가능합니다.

```bash
python integrated_analyzer.py
```

**키보드 단축키:**

- `TAB` : Willis 계측법 ↔ 상세 분석 모드 전환
- `q` 또는 `ESC` : 종료
- `s` : 스크린샷 저장
- `r` : Willis 리포트 저장 (JSON)
- `c` : 데이터 초기화

---

### Willis 계측법 전용 모드

수직 고경 평가에만 집중하는 모드입니다.

```bash
python willis_measurement.py
```

또는

```bash
python integrated_analyzer.py --willis
```

**화면 표시 정보:**

```
=== Willis 안면 계측법 ===
동공-구열 거리: 245.3px
비저부-턱끝 거리: 230.8px
비율: 0.941
판정: 평균 이하 (수직고경 감소)
```

---

### 상세 분석 전용 모드

입과 턱의 세부 측정에 집중하는 모드입니다.

```bash
python main.py
```

또는

```bash
python integrated_analyzer.py --detail
```

---

### 고급 모드 (실시간 그래프 포함)

```bash
python advanced_analyzer.py
```

**추가 기능:**

- 실시간 그래프 (입 벌림, 턱 각도, 대칭성)
- 데이터 기록 (REC 버튼)
- 분석 요약 이미지 생성

## 출력 파일 📁

### Willis 계측 리포트 (JSON)

```json
{
  "analysis_date": "2025-12-19T15:30:45",
  "total_frames": 250,
  "willis_method": {
    "description": "Willis 안면 계측법: 동공-구열 거리와 비저부-턱끝 거리 비교",
    "normal_criteria": "0.95 <= ratio <= 1.05"
  },
  "statistics": {
    "ratio": {
      "mean": 0.942,
      "min": 0.93,
      "max": 0.958
    }
  },
  "classification_summary": {
    "normal": {
      "count": 45,
      "percentage": "18.0%"
    },
    "below_average": {
      "count": 205,
      "percentage": "82.0%",
      "note": "수직 고경 감소 가능성"
    }
  },
  "recommendation": "수직 고경 감소 가능성. 추가 검사 고려."
}
```

### 스크린샷

- `willis_measurement_YYYYMMDD_HHMMSS.png`
- `dental_detail_YYYYMMDD_HHMMSS.png`

## 프로그램 구조 🏗️

```
facemap/
├── willis_measurement.py        # Willis 안면 계측법 핵심 모듈 ⭐
├── integrated_analyzer.py       # 통합 분석 프로그램 (권장) ⭐
├── main.py                      # 기본 얼굴 인식 프로그램
├── dental_visualizer.py         # 시각화 및 분석 모듈
├── advanced_analyzer.py         # 고급 분석 (그래프 포함)
├── requirements.txt             # 필수 패키지
├── README.md                    # 이 문서
└── 000000076274_20251209071318 (1).pdf  # 참고 논문
```

## Willis 계측법 상세 설명 📐

### 측정 방법

1. **동공 중심점 계산**

   - 양쪽 동공 위치 감지
   - 중심점 계산

2. **구열(입) 중심점 계산**

   - 입술의 수직 중앙 위치
   - 윗입술과 아랫입술 사이

3. **비저부 위치**

   - 코의 아래 부분 (nasal base)
   - MediaPipe landmark #2

4. **턱끝 위치**
   - 턱의 가장 아래 지점 (menton)
   - MediaPipe landmark #152

### 판정 알고리즘

```python
비율 = (비저부-턱끝 거리) / (동공-구열 거리)

if 0.95 <= 비율 <= 1.05:
    판정 = "정상"
elif 비율 < 0.95:
    판정 = "평균 이하 (수직 고경 감소)"
else:
    판정 = "평균 이상"
```

### 임상적 의미

| 비율 범위   | 판정        | 임상적 의미                           |
| ----------- | ----------- | ------------------------------------- |
| < 0.90      | 심각한 감소 | 즉시 전문의 상담 필요                 |
| 0.90 ~ 0.95 | 평균 이하   | 수직 고경 감소 가능성, 추가 검사 고려 |
| 0.95 ~ 1.05 | 정상        | 양호한 안모 비율                      |
| > 1.05      | 평균 이상   | 추가 평가 고려                        |

## 치과 활용 예시 🏥

### 1. 수직 고경 감소 진단

- **문제**: 다수 치아 상실, 치아 마모로 인한 수직 고경 감소
- **활용**: Willis 계측법으로 객관적 평가
- **결과**: 비율 < 0.95 → 전악 보철 수복 고려

### 2. 치료 전후 비교

- 치료 전 Willis 비율 측정
- 보철 수복 후 재측정
- 수직 고경 회복 확인

### 3. 교정 치료 계획

- 턱 각도 및 대칭성 평가
- 입 모양 변화 추적
- 심미적 목표 설정

### 4. 환자 교육

- 실시간 시각화로 상태 설명
- 색상 코드로 직관적 이해
- 치료 필요성 설득력 향상

## 논문 연구 결과 📊

논문에서 보고된 Neuro-T 모델의 성능:

- **정면 얼굴 사진 분류 정확도**: 90.00%
- **측면 얼굴 사진**: 84.00%
- **측방두부방사선사진**: 73.07%

→ 정면 얼굴 사진이 Willis 계측법에 가장 효과적

**교육적 효과:**

- 치과대학 학생과 전공의의 Willis 분류 정확도가 프로그램 사용 후 유의하게 상승
- 임상 교육 도구로서의 활용 가능성 입증

## 시스템 요구사항 💻

- **OS**: Windows 10/11, macOS 10.14+, Linux
- **Python**: 3.8 이상
- **RAM**: 최소 4GB (8GB 권장)
- **웹캠**: 720p 이상 권장 (정면 촬영)
- **프로세서**: Intel i5 이상 또는 동급

## 사용 팁 💡

### Willis 계측을 위한 최적 촬영 조건

1. **정면 응시**: 카메라를 정면으로 똑바로 보기
2. **적절한 거리**: 얼굴 전체가 화면에 들어오도록
3. **조명**: 균일한 조명, 그림자 최소화
4. **자세**: 자연스러운 입 다문 상태 (교합 수직 고경)
5. **표정**: 편안하고 중립적인 표정

### 정확도 향상 방법

- 여러 번 측정하여 평균값 사용
- 리포트 저장 기능으로 측정 데이터 기록
- 같은 조건에서 반복 측정

## 문제 해결 🔧

### 얼굴이 감지되지 않음

- 조명 확인 (너무 어둡거나 밝지 않게)
- 카메라와의 거리 조절
- 정면 응시 확인

### Willis 비율이 불안정함

- 여러 프레임 측정 후 평균 사용
- 머리 움직임 최소화
- 안정적인 자세 유지

### 카메라가 열리지 않음

```python
# integrated_analyzer.py에서 camera_id 변경
cap = cv2.VideoCapture(1)  # 0 대신 1로 시도
```

## 참고 문헌 📚

1. Willis, F. M. (1935). Features of the face as related to the Gothic arch. _Dental Cosmos_, 77, 780-787.

2. "딥러닝 기반 Neuro-T 모델을 이용한 Willis 안면 계측법의 안모 비율 분류 정확도 및 교육적 효과 평가", 전남대학교 치과대학 박사학위논문, 2025

3. [MediaPipe Face Mesh](https://google.github.io/mediapipe/solutions/face_mesh.html)

4. Turner, L. N., & Triplett, R. G. (1998). Modification of the occlusal vertical dimension: A literature review. _Quintessence International_, 29(6), 359-368.

## 라이선스 및 주의사항 ⚖️

### 사용 목적

- 교육 및 연구 목적으로 자유롭게 사용 가능
- 임상 보조 도구로 활용 가능

### 주의사항

⚠️ **이 프로그램은 진단 보조 도구입니다**

- 최종 진단은 반드시 치과 전문의가 수행해야 합니다
- 프로그램 결과만으로 치료 결정을 내리지 마세요
- 의료 기기로 사용하려면 관련 규정 및 승인 필요

## 업데이트 계획 🚧

- [x] Willis 안면 계측법 구현
- [x] 정상/평균이하 자동 분류
- [x] 실시간 측정 및 시각화
- [ ] 측정값 데이터베이스 저장
- [ ] 환자별 이력 관리
- [ ] 치료 전후 비교 기능
- [ ] 다중 환자 비교 분석
- [ ] AI 기반 정확도 개선

## 개발자 정보 👨‍💻

**논문 기반 구현**

- 원저: 전남대학교 치과대학 (김수헌, 지도교수: 윤귀덕)
- 구현: MediaPipe + OpenCV 기반 Python 프로그램

---

**Made with ❤️ for Dental Care - Based on Academic Research**
